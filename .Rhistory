show_pct = T)
gg_miss_fct(x = monthly_df$te_forest,
fct = monthly_df$Cutaneous.Leishmaniasis)
gg_miss_fct(x = monthly_df$te_forest,
fct = monthly_df$Cutaneous.Leishmaniasis.fct)
aad <- read_csv('models/data/aad.csv')
ggplot(aad,
aes(x = te_forest,
y = Cutaneous.Leishmaniasis)) +
geom_miss_point() +
facet_wrap(~ Year) +
theme_dark()
ggplot(aad,
aes(x = te_forest,
y = Cutaneous.Leishmaniasis),
alpha = 0.1) +
geom_miss_point() +
facet_wrap(~ Year) +
theme_dark()
ggplot(aad,
aes(x = te_forest,
y = Cutaneous.Leishmaniasis),
cex = 0.1) +
geom_miss_point() +
facet_wrap(~ Year) +
theme_dark()
ggplot(aad,
aes(x = te_forest,
y = Cutaneous.Leishmaniasis)) +
geom_miss_point(alpha = 0.1) +
facet_wrap(~ Year) +
theme_dark()
knitr::opts_chunk$set(echo = TRUE,
cache = T)
library(ggpubr)
library(readr)
library(dplyr)
library(knitr)
library(kableExtra)
library(ggplot2)
# LST_Day vs. Precip
ggplot(data, aes(x = LST_Day,
y = Precip,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
knitr::opts_chunk$set(echo = TRUE,
cache = T)
library(ggpubr)
library(readr)
library(dplyr)
library(knitr)
library(kableExtra)
library(ggplot2)
data <- read_csv('../models/data/aad.csv')
colnames(data)
ggdensity(data$Population %>% log()) # Normal
ggdensity(data$LST_Day) # Normal
ggdensity(data$NDVI) # Unknown
ggdensity(data$EVI) # Unknown
ggdensity(data$Precip %>% sqrt()) # Normal?
ggdensity(data$AvgRad %>% log) # Normal
ggdensity(data$SWOccurrence) # Not
ggdensity(data$pland_forest %>% sqrt) # Not
ggdensity(data$area_mn_forest %>% log) # Not
ggdensity(data$enn_mn_forest %>% log) # Not
ggdensity(data$te_forest %>% log) # Not
normality_check <- c('Normal', 'Normal',
'Unknown', 'Unknown',
'Normal', 'Normal',
'Not Normal', 'Not Normal',
'Not Normal', 'Not Normal',
'Not Normal')
normality_df <- data.frame(Variable = c('log(Population)', 'LST_Day',
'NDVI', 'EVI',
'sqrt(Precip)', 'log(AvgRad)',
'SWOccurrence', 'sqrt(pland_forest)',
'log(area_mn_forest)', 'log(enn_mn_forest)',
'log(te_forest)'),
Normality = normality_check)
knitr::kable(normality_df,
format = 'html') %>%
kable_styling(full_width = F, font_size = 12)
# Produce a threshold to split high- and low-risk municipalities, obtained from post-hoc analysis in stacked model
quantile_data <- data %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
dplyr::select(Cutaneous.Leishmaniasis)
quantile <- (quantile_data$Cutaneous.Leishmaniasis %>%
quantile(0.4))[[1]]
# Create a new variable risk
data <- data %>%
group_by(Code) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(sum(Cutaneous.Leishmaniasis) > 0) %>% # only interested in municipalities who have at least one observaiton of cutaneous leishmaniasis
ungroup() %>%
mutate(risk = ifelse(Cutaneous.Leishmaniasis < quantile, 'low', 'high') %>%
as.factor())
# Separate data into low and high risk lists to use in wilcox.test()
low_risk <- data %>%
filter(risk == 'low') %>%
as.list()
high_risk <- data %>%
filter(risk == 'high') %>%
as.list()
wilcox.test(low_risk$Population, high_risk$Population)
t.test(low_risk$Population, high_risk$Population)
wilcox.test(low_risk$AvgRad, high_risk$AvgRad)
wilcox.test(low_risk$te_forest, high_risk$te_forest)
wilcox.test(low_risk$SWOccurrence, high_risk$SWOccurrence)
wilcox.test(low_risk$Year, high_risk$Year)
wilcox.test(low_risk$te_riverlakeocean, high_risk$te_riverlakeocean)
numeric_vars <- colnames(data)[5:69]
for(i in numeric_vars) {
print(i)
wilcox.test(low_risk[[i]], high_risk[[i]]) %>% print()
t.test(low_risk[[i]], high_risk[[i]]) %>% print()
}
# LST_Day vs. Precip
ggplot(data, aes(x = LST_Day,
y = Precip,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
# LST_Day vs. forest
ggplot(data, aes(x = LST_Day,
y = te_forest,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
# Population vs. forest
ggplot(data, aes(x = log(Population),
y = te_forest,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
# Population vs. LST_Day
ggplot(data, aes(x = log(Population),
y = LST_Day,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
# Population vs. EVI
ggplot(data, aes(x = log(Population),
y = EVI,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
# Population vs. NDVI
ggplot(data, aes(x = log(Population),
y = NDVI,
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
# Population vs. Precip
ggplot(data, aes(x = log(Population),
y = sqrt(Precip),
color = risk)) +
geom_point(alpha = 0.2) +
geom_smooth(aes(group = risk),
method = 'nls', formula = y ~ a * x + b, se = F,
method.args = list(start = list(a = 0.1, b = 0.1)))
knitr::opts_chunk$set(echo = T,
cache = F,
eval = T,
results = 'show',
warning = F,
message = F)
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
set.seed(123)
library(readr)
library(tidyverse)
library(tidymodels)
library(stacks)
library(dplyr)
library(caret)
library(kernlab)
# load model
load('model_stacks/FINAL_model_st_later_CL_classif_40')
load('data_tests/FINAL_data_test_later_CL_classif_40')
aad <- read_csv('../../models/data/aad.csv')
monthly <- read_csv('../../data/monthly_df.csv')
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
data_res_no_month <- data %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class) %>%
select(-c(Month))
data_res <- complete %>%
as.data.frame() %>%
select(c(-Name)) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Cutaneous.Leishmaniasis = ifelse(
Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1) %>% as.numeric()) %>%
select(c(colnames(data_res_no_month)))
summary(aad_new)
# TODO: get 2019 levels to match all other years
# remove 2019 new_aad from total_data
monthly_short <- monthly %>%
filter(Year > 2013) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(EVI)) %>%
filter(!is.na(NDVI)) %>%
filter(!is.na(Precip)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Month = (Year - 2014)*12 + Month) %>%
select(c(Name, Code, Year, Month,
Population, LST_Day,
NDVI, EVI, Precip,
AvgRad, SWOccurrence,
pland_forest, area_mn_forest,
enn_mn_forest, te_forest)) %>%
mutate(pland_forest = ifelse(is.na(pland_forest), 0,
pland_forest)) %>%
mutate(area_mn_forest = ifelse(is.na(area_mn_forest), 0,
area_mn_forest)) %>%
mutate(enn_mn_forest = ifelse(is.na(enn_mn_forest), 0,
enn_mn_forest)) %>%
mutate(te_forest = ifelse(is.na(te_forest), 0,
te_forest)) %>%
mutate(Code = sub("^0+", "", Code) %>% as.integer())
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup() %>%
mutate(Population = as.integer(Population))
data_res_2019 <- tool_2019 %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
# Summarize by month
summary_month <- data_res %>%
group_by(Month) %>%
summarise_all(mean)
# Update 2019 for total_data
total_data_no_2019 <- rbind(data_res %>% select(c(-Month)), aad_new %>% select(c(-Name))) %>%
mutate(Cutaneous.Leishmaniasis = as.numeric(Cutaneous.Leishmaniasis) - 1) %>%
filter(Year != 2019)
total_data <- rbind(total_data_no_2019, data_res_2019 %>% select(-c(Month)))
# Summarize by year
summary_year <- total_data %>%
group_by(Year) %>%
mutate_all(as.numeric) %>%
summarise_all(mean) %>%
ungroup() %>%
mutate(Precip = case_when(Year < 2020 ~ Precip,
Year >= 2020 ~ Precip * 12)) %>%
mutate(Code = NULL)
summary_year
monthly_short <- monthly %>%
filter(Year %in% c(2018, 2019)) %>%
group_by(Month) %>%
summarise_all(median)
monthly_short
pop_diff <- (monthly %>%
filter(Year == 2019) %>%
select(c(Month, Population)) %>%
slice(which(row_number() %% 12 == 0))) - (monthly %>%
filter(Year == 2018) %>%
select(c(Month, Population)) %>%
slice(which(row_number() %% 12 == 0))) %>%
mutate(Month = row_number())
ggplot(pop_diff) +
geom_point(aes(x = Month,
y = Population))
monthly_short <- monthly %>%
filter(Year %in% c(2018, 2019)) %>%
group_by(Month) %>%
summarise_all(median)
monthly_short
pop_diff <- (monthly %>%
filter(Year == 2019) %>%
select(c(Month, Population)) %>%
slice(which(row_number() %% 12 == 0))) - (monthly %>%
filter(Year == 2018) %>%
select(c(Month, Population)) %>%
slice(which(row_number() %% 12 == 0))) %>%
mutate(Month = row_number())
ggplot(pop_diff) +
geom_point(aes(x = Month,
y = Population))
data <- test_rwf_df_1m %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
aad_new %>%
select(c(Cutaneous.Leishmaniasis, Year)) %>%
group_by(Year) %>%
summarise(mean = mean(Cutaneous.Leishmaniasis))
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(aad$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year == 2019))$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_24m')
data <- test_rwf_df_24 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(aad$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_24m')
data <- test_rwf_df_24 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
data <- test_rwf_df_1m %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
aad_new %>%
select(c(Cutaneous.Leishmaniasis, Year)) %>%
group_by(Year) %>%
summarise(mean = mean(Cutaneous.Leishmaniasis))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
paste(table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_24m')
data <- test_rwf_df_24 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_36m')
data <- test_rwf_df_36 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_48m')
data <- test_rwf_df_48 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_60m')
data <- test_rwf_df_60 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_60m')
data <- test_rwf_df_60 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(aad_new$Cutaneous.Leishmaniasis)
table((aad_new %>% filter(Year %in% c(2018, 2019)))$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
