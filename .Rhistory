mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup() %>%
as.data.frame()
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
model_st_40
tool_2019
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup() %>%
as.data.frame()
tool_2019
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(caret::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(caret::predict.train(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(stats::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
library(caret)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(caret::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
library(kenlab)
library(kernlab)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(kernlab::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup()
data_res_2019 <- tool_2019 %>%
bind_cols(kernlab::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(kernlab::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
?predict
data_res_2019 <- tool_2019 %>%
bind_cols(kernlab::predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
?kernlab::predict
?karet::predict
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
knitr::opts_chunk$set(echo = T,
cache = F,
eval = T,
results = 'show',
warning = F,
message = F)
set.seed(123)
library(readr)
library(tidyverse)
library(tidymodels)
library(stacks)
library(dplyr)
library(caret)
library(kernlab)
# load model
load('model_stacks/FINAL_model_st_later_CL_classif_40')
load('data_tests/FINAL_data_test_later_CL_classif_40')
aad <- read_csv('../../models/data/aad.csv')
monthly <- read_csv('../../data/monthly_df.csv')
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data_res <- complete %>%
as.data.frame() %>%
select(c(-Name)) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
# TODO: get 2019 levels to match all other years
# remove 2019 new_aad from total_data
monthly_short <- monthly %>%
filter(Year > 2013) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(EVI)) %>%
filter(!is.na(NDVI)) %>%
filter(!is.na(Precip)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Month = (Year - 2014)*12 + Month) %>%
select(c(Name, Code, Year, Month,
Population, LST_Day,
NDVI, EVI, Precip,
AvgRad, SWOccurrence,
pland_forest, area_mn_forest,
enn_mn_forest, te_forest)) %>%
mutate(pland_forest = ifelse(is.na(pland_forest), 0,
pland_forest)) %>%
mutate(area_mn_forest = ifelse(is.na(area_mn_forest), 0,
area_mn_forest)) %>%
mutate(te_forest = ifelse(is.na(te_forest), 0,
te_forest)) %>%
mutate(Code = sub("^0+", "", Code) %>% as.integer())
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup()
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019
data_res_2019
data_res_2019 <- tool_2019 %>%
as.data.frame()
data_res_2019
data_res_2019 <- tool_2019 %>%
as.data.frame() %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019
total_data
data_res <- complete %>%
as.data.frame() %>%
select(c(-Name)) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res
# TODO: get 2019 levels to match all other years
# remove 2019 new_aad from total_data
monthly_short <- monthly %>%
filter(Year > 2013) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(EVI)) %>%
filter(!is.na(NDVI)) %>%
filter(!is.na(Precip)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Month = (Year - 2014)*12 + Month) %>%
select(c(Name, Code, Year, Month,
Population, LST_Day,
NDVI, EVI, Precip,
AvgRad, SWOccurrence,
pland_forest, area_mn_forest,
enn_mn_forest, te_forest)) %>%
mutate(pland_forest = ifelse(is.na(pland_forest), 0,
pland_forest)) %>%
mutate(area_mn_forest = ifelse(is.na(area_mn_forest), 0,
area_mn_forest)) %>%
mutate(enn_mn_forest = ifelse(is.na(enn_mn_forest), 0,
enn_mn_forest)) %>%
mutate(te_forest = ifelse(is.na(te_forest), 0,
te_forest)) %>%
mutate(Code = sub("^0+", "", Code) %>% as.integer())
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup()
data_res_2019 <- tool_2019 %>%
as.data.frame() %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(., model_st_40)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
predict(tool_2019, model_st_40)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019 %>% summary
data_res_2019
total_data <- rbind(data_res_no_month, aad_new) %>%
mutate(Cutaneous.Leishmaniasis = as.numeric(Cutaneous.Leishmaniasis) - 1)
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
# Summarize by month
summary_month <- data_res %>%
group_by(Month) %>%
summarise_all(mean)
summary_month
# Summarize by year
summary_year <- total_data %>%
group_by(Year) %>%
summarise_all(mean) %>%
mutate(Precip = ifelse(Year > 2019, Precip * 12, Precip)) %>%
mutate_all(as.numeric)
data <- rbind(test_rwf_df_12m, test_rwf_df_24m,
test_rwf_df_36m, test_rwf_df_48m,
test_rwf_df_60m) %>%
mutate(Population = as.integer(Population))
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
data <- rbind(test_rwf_df_12m, test_rwf_df_24m,
test_rwf_df_36m, test_rwf_df_48m,
test_rwf_df_60m) %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36m, test_rwf_df_48m,
test_rwf_df_60m) %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
load('../../extrapolation/projected_input_60m')
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
load('../../extrapolation/projected_input_60m')
test_rwf_df_60 <- test_rwf_df_9 %>%
filter(Month == 60)
save(test_rwf_df_60, file = 'projected_input_60m')
write.csv(test_rwf_df_60, file = 'projected_input_60m.csv')
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
data_res_no_month <- data %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class) %>%
select(-c(Month))
data_res_no_month <- data %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class) %>%
select(-c(Month))
data_res %>%
group_by(Year) %>%
summarise_all(mean) %>%
View()
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
data_res_no_month <- data %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class) %>%
select(-c(Month))
data_res %>%
group_by(Year) %>%
summarise_all(mean) %>%
View()
data_res <- complete %>%
as.data.frame() %>%
select(c(-Name)) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Cutaneous.Leishmaniasis = ifelse(
Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1) %>% as.numeric()) %>%
select(c(colnames(data_res_no_month)))
summary(aad_new)
total_data <- rbind(data_res_no_month, aad_new) %>%
mutate(Cutaneous.Leishmaniasis = as.numeric(Cutaneous.Leishmaniasis) - 1)
# TODO: get 2019 levels to match all other years
# remove 2019 new_aad from total_data
monthly_short <- monthly %>%
filter(Year > 2013) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(EVI)) %>%
filter(!is.na(NDVI)) %>%
filter(!is.na(Precip)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Month = (Year - 2014)*12 + Month) %>%
select(c(Name, Code, Year, Month,
Population, LST_Day,
NDVI, EVI, Precip,
AvgRad, SWOccurrence,
pland_forest, area_mn_forest,
enn_mn_forest, te_forest)) %>%
mutate(pland_forest = ifelse(is.na(pland_forest), 0,
pland_forest)) %>%
mutate(area_mn_forest = ifelse(is.na(area_mn_forest), 0,
area_mn_forest)) %>%
mutate(enn_mn_forest = ifelse(is.na(enn_mn_forest), 0,
enn_mn_forest)) %>%
mutate(te_forest = ifelse(is.na(te_forest), 0,
te_forest)) %>%
mutate(Code = sub("^0+", "", Code) %>% as.integer())
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup()
data_res_2019 <- tool_2019 %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
select(c(colnames(complete))) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res
data_res_2019 <- tool_2019 %>%
select(c(data_res %>% select(-c(Cutaneous.Leishmaniasis)) %>%
colnames()))
data_res_2019 <- tool_2019 %>%
select(c(data_res %>% select(-c(Cutaneous.Leishmaniasis)) %>%
colnames())) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
data_res_2019 <- tool_2019 %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
tool_2019 %>% dim
set.seed(123)
library(readr)
library(tidyverse)
library(tidymodels)
library(stacks)
library(dplyr)
library(caret)
library(kernlab)
# load model
load('model_stacks/FINAL_model_st_later_CL_classif_40')
load('data_tests/FINAL_data_test_later_CL_classif_40')
aad <- read_csv('../../models/data/aad.csv')
monthly <- read_csv('../../data/monthly_df.csv')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data_res <- complete %>%
as.data.frame() %>%
select(c(-Name)) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Cutaneous.Leishmaniasis = ifelse(
Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1) %>% as.numeric()) %>%
select(c(colnames(data_res_no_month)))
load('../../extrapolation/projected_input_1m')
load('../../extrapolation/projected_input_12m')
load('../../extrapolation/projected_input_24m')
load('../../extrapolation/projected_input_36m')
load('../../extrapolation/projected_input_48m')
load('../../extrapolation/projected_input_60m')
load('../../extrapolation/complete_projected')
complete <- test_rwf_df_9 %>%
mutate(Population = as.integer(Population))
data <- rbind(test_rwf_df_12, test_rwf_df_24,
test_rwf_df_36, test_rwf_df_48,
test_rwf_df_60) %>%
mutate(Population = as.integer(Population))
data_res_no_month <- data %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class) %>%
select(-c(Month))
data_res %>%
group_by(Year) %>%
summarise_all(mean) %>%
View()
data_res <- complete %>%
as.data.frame() %>%
select(c(-Name)) %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Cutaneous.Leishmaniasis = ifelse(
Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1) %>% as.numeric()) %>%
select(c(colnames(data_res_no_month)))
summary(aad_new)
total_data <- rbind(data_res_no_month, aad_new) %>%
mutate(Cutaneous.Leishmaniasis = as.numeric(Cutaneous.Leishmaniasis) - 1)
# TODO: get 2019 levels to match all other years
# remove 2019 new_aad from total_data
monthly_short <- monthly %>%
filter(Year > 2013) %>%
filter(!is.na(LST_Day)) %>%
filter(!is.na(AvgRad)) %>%
filter(!is.na(EVI)) %>%
filter(!is.na(NDVI)) %>%
filter(!is.na(Precip)) %>%
filter(!is.na(SWOccurrence)) %>%
mutate(Month = (Year - 2014)*12 + Month) %>%
select(c(Name, Code, Year, Month,
Population, LST_Day,
NDVI, EVI, Precip,
AvgRad, SWOccurrence,
pland_forest, area_mn_forest,
enn_mn_forest, te_forest)) %>%
mutate(pland_forest = ifelse(is.na(pland_forest), 0,
pland_forest)) %>%
mutate(area_mn_forest = ifelse(is.na(area_mn_forest), 0,
area_mn_forest)) %>%
mutate(enn_mn_forest = ifelse(is.na(enn_mn_forest), 0,
enn_mn_forest)) %>%
mutate(te_forest = ifelse(is.na(te_forest), 0,
te_forest)) %>%
mutate(Code = sub("^0+", "", Code) %>% as.integer())
tool_2019 <- monthly_short %>%
filter(Year == 2019) %>%
group_by(Code) %>%
mutate(Precip = sum(Precip)) %>%
mutate(Population = as.numeric(Population)) %>%
mutate(Code = as.numeric(Code)) %>%
summarise_if(is.numeric, mean) %>%
ungroup()
data_res_2019 <- tool_2019 %>%
bind_cols(predict(model_st_40,.)) %>%
rename(Cutaneous.Leishmaniasis = .pred_class)
