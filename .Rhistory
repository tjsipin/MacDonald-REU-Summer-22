'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')))
data <- test_rwf_df_10 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population'))
data_res <-
data %>%
bind_cols(predict(model_st_40,.))
data %>% colnames
load('model_stacks/FINAL_model_st_later_CL_classif_40')
data_res <-
data %>%
bind_cols(predict(model_st_40,.))
data_res <-
predict(model_st_40,data))
data_res <-
predict(model_st_40,data)
load('data_tests/TEMP_data_test_later_CL_classif_40')
data_test_40
load('data_stacks/TEMP_data_st_later_CL_classif_40')
data_st_40
data_st_40$.pred_1_nb_res_1_1
# helper packages
library(tidyverse)
library(tidymodels)
library(stacks)
# load and split the early data using imputed data
load('../../data/imp')
aad <- read.csv('../data/aad.csv')
quantile_data <- data %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
dplyr::select(Cutaneous.Leishmaniasis)
quantile <- (quantile_data$Cutaneous.Leishmaniasis %>%
quantile(0.4))[[1]] # PARAMETER
data <- data %>%
filter(Year >= 2014) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
dplyr::select(c('Cutaneous.Leishmaniasis', 'LST_Day', 'Year', # include LST_Night?
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population'))
data$pland_forest <- ifelse(is.na(data$pland_forest), 0, data$pland_forest)
data$te_forest <- ifelse(is.na(data$te_forest), 0, data$te_forest)
data$enn_mn_forest <- ifelse(is.na(data$enn_mn_forest), 0, data$enn_mn_forest)
data$Cutaneous.Leishmaniasis <- as.factor(ifelse(data$Cutaneous.Leishmaniasis < quantile, 0, 1))
set.seed(123) # for reproducibility
aad <- aad %>%
filter(Year >= 2014) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
filter(Cutaneous.Leishmaniasis > 0)
split <- initial_split(data)
data_train <- training(split)
data_test_40_temp <- testing(split)
data_test_40 <-  (aad %>%
select(c(colnames(data_test_40_temp))))[Index_temp,] %>%
subset(!is.na(LST_Day)) %>%
subset(!is.na(SWOccurrence))
data_test_40
data_test_40$pland_forest <- ifelse(is.na(data_test_40$pland_forest), 0, data_test_40$pland_forest)
data_test_40$te_forest <- ifelse(is.na(data_test_40$te_forest), 0, data_test_40$te_forest)
data_test_40$enn_mn_forest <- ifelse(is.na(data_test_40$enn_mn_forest), 0, data_test_40$enn_mn_forest)
data_test_40$Cutaneous.Leishmaniasis <- as.factor(ifelse(data_test_40$Cutaneous.Leishmaniasis < quantile, 0, 1))
data_test_40 %>% dim
set.seed(123)
library(tidyverse)
library(tidymodels)
library(stacks)
library(dplyr)
load('../../extrapolation/projected_input')
data <- test_rwf_df_10 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population'))
data_test_40 %>% dim
data %>% dim
knitr::opts_chunk$set(echo = T,
cache = F,
eval = T,
results = 'show',
warning = F,
message = F)
set.seed(123)
library(tidyverse)
library(tidymodels)
library(stacks)
library(dplyr)
# load model
load('model_stacks/FINAL_model_st_later_CL_classif_40')
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_24m')
data <- test_rwf_df_24 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
test_rwf_df_9
test_rwf_df_24
test_rwf_df_12 <- test_rwf_df_9 %>%
filter(Month == 12)
save(test_rwf_df_12, file = 'projected_input_12m')
write.csv(test_rwf_df_12, file = 'projectedd_input_12m.csv')
test_rwf_df_24 <- test_rwf_df_9 %>%
filter(Month == 24)
save(test_rwf_df_24, file = 'projected_input_24m')
write.csv(test_rwf_df_24, file = 'projectedd_input_24m.csv')
test_rwf_df_36 <- test_rwf_df_9 %>%
filter(Month == 36)
save(test_rwf_df_36, file = 'projected_input_36m')
write.csv(test_rwf_df_36, file = 'projectedd_input_36m.csv')
test_rwf_df_48 <- test_rwf_df_9 %>%
filter(Month == 48)
save(test_rwf_df_48, file = 'projected_input_48m')
write.csv(test_rwf_df_48, file = 'projectedd_input_48m.csv')
test_rwf_df_60 <- test_rwf_df_9 %>%
filter(Month == 60)
save(test_rwf_df_10, file = 'projected_input_60m')
write.csv(test_rwf_df_10, file = 'projected_input_60m.csv')
test_rwf_df_12
test_rwf_df_24
test_rwf_df_36
test_rwf_df_48
test_rwf_df_60
test_rwf_df_9
load('../../extrapolation/projected_input_36m')
data <- test_rwf_df_36 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_48m')
data <- test_rwf_df_48 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('data_tests/FINAL_data_test_later_CL_classif_40')
table(data_test_40$.pred_class)
table(data_res$.pred_class)
table(data_test_40$.pred_class)
table(data_res$.pred_class)
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_12m')
data <- test_rwf_df_12 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_24m')
data <- test_rwf_df_24 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_36m')
data <- test_rwf_df_36 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_48m')
data <- test_rwf_df_48 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
load('../../extrapolation/projected_input_60m')
data <- test_rwf_df_60 %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
# helper packages
library(tidyverse)
library(tidymodels)
library(stacks)
# load and split the early data using imputed data
load('../../data/imp')
aad <- read.csv('../data/aad.csv')
test_rwf_df_1m <- test_rwf_df_9 %>%
filter(Month == 1)
save(test_rwf_df_1m, file = 'projected_input_1m')
write.csv(test_rwf_df_1m, file = 'projectedd_input_1m.csv')
load('../../extrapolation/projected_input_1m')
data <- test_rwf_df_1m %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
table(data_test_40$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
aad <- read.csv('../data/aad.csv')
table(aad %>%
select(Cutaneous.Leishmaniasis))
quantile(Cutaneous.Leishmaniasis, 0.4))
quantile(Cutaneous.Leishmaniasis, 0.4)
quantile(aad$Cutaneous.Leishmaniasis, 0.4))
quantile(aad$Cutaneous.Leishmaniasis, 0.4)
quantile(aad$Cutaneous.Leishmaniasis, 0.4, na.rm = T)
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(Cutaneous.Leishmaniasis %>% !is.na()) %>%
mutate(ifelse(Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1)) %>%
filter(Year == max(Year))
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(Cutaneous.Leishmaniasis %>% !is.na())
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
mutate(ifelse(Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1)) %>%
filter(Year == max(Year))
aad_new
test_rwf_df_9
table(aad_new$Cutaneous.Leishmaniasis)
# Set up aad to check
aad_new <- aad %>%
filter(Cutaneous.Leishmaniasis > 0) %>%
filter(!is.na(Cutaneous.Leishmaniasis)) %>%
mutate(Cutaneous.Leishmaniasis = ifelse(Cutaneous.Leishmaniasis < quantile(Cutaneous.Leishmaniasis, 0.4), 0, 1)) %>%
filter(Year == max(Year))
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
table(aad_new$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(aad_new$Cutaneous.Leishmaniasis)
table(data_res$.pred_class)
109/465
742/7523
465/(109/465)
465/(109+465)
7523/(7523 + 743)
test_rwf_df_deploy <- data.frame(c(test_rwf_df_12,
test_rwf_df_24,
test_rwf_df_36,
test_rwf_df_48,
test_rwf_df_60))
test_rwf_df_deploy
test_rwf_df_deploy <- data.frame(test_rwf_df_12,
test_rwf_df_24,
test_rwf_df_36,
test_rwf_df_48,
test_rwf_df_60)
test_rwf_df_deploy
test_rwf_df_deploy <- data.frame(test_rwf_df_12,
test_rwf_df_24,
test_rwf_df_36,
test_rwf_df_48,
test_rwf_df_60,
nrow = 13)
test_rwf_df_deploy
test_rwf_df_deploy <- test_rwf_df_9 %>%
filter(Month == c(12,24,36,48,60))
test_rwf_df_deploy
test_rwf_df_deploy <- test_rwf_df_9 %>%
filter(Month == c(12,24,36,48,60))
test_rwf_df_deploy %>% summary()
test_rwf_df_deploy <- test_rwf_df_9 %>%
filter(Month in c(12,24,36,48,60))
test_rwf_df_deploy <- test_rwf_df_9 %>%
filter(Month %in% c(12,24,36,48,60))
test_rwf_df_deploy %>% summary()
save(test_rwf_df_deploy, file = 'test_rwf_df_deploy')
write.csv(test_rwf_df_deploy, file = 'test_rwf_deploy.csv')
load('../../extrapolation/test_rwf_df_deploy')
test_rwf_df_deploy
load('../../extrapolation/test_rwf_df_deploy')
data <- test_rwf_df_deploy %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
load('../../extrapolation/test_rwf_df_deploy')
data <- test_rwf_df_deploy %>%
select(c('LST_Day', 'Year',
'NDVI', 'EVI', 'Precip',
'AvgRad', 'SWOccurrence', 'pland_forest',
'te_forest', 'enn_mn_forest','Population')) %>%
mutate(Population = as.integer(Population))
data_res <- data %>%
bind_cols(predict(model_st_40,.))
ggplot(data_res) +
geom_point(aes(y = .pred_class,
color = Year))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
color = Year))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Year))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Year))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Month))
data_res %>% names
data_res <- data %>%
bind_cols(predict(model_st_40,.)) %>%
bind_cols(test_rwf_df_deploy$Month)
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Month))
data_res
data_res <- data %>%
bind_cols(predict(model_st_40,.)) %>%
bind_cols(Month = test_rwf_df_deploy$Month)
data_res
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Month))
ggplot(data_res) +
geom_boxplot(aes(x = .pred_class,
y = Month))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Month))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
color = Month))
ggplot(data_res) +
geom_boxplot(aes(y = .pred_class,
x = Month))
ggplot(data_res) +
ggplot(aes(x = Population,
y = .pred_class,
color = Month))
ggplot(data_res) +
geom_point(aes(x = Population,
y = .pred_class,
color = Month))
ggplot(data_res) +
geom_boxplot(aes(x = Population,
y = .pred_class,
color = Month))
ggplot(data_res) +
geom_area(aes(x = Population,
y = .pred_class,
color = Month))
ggplot(data_res) +
geom_line(aes(x = Population,
y = .pred_class,
color = Month))
ggplot(data_res) +
geom_point(aes(y = Population,
x = Month,
color = .pred_class))
ggplot(data_res) +
geom_boxplot(aes(y = Population,
x = Month,
color = .pred_class))
ggplot(data_res) +
geom_boxplot(aes(x = Population,
y = Month,
color = .pred_class))
ggplot(data_res) +
geom_line(aes(x = Population,
y = Month,
color = .pred_class))
ggplot(data_res) +
geom_line(aes(x = Population,
y = Month,
color = .pred_class))
ggplot(data_res) +
geom_point(aes(x = Population,
y = Month,
color = .pred_class))
ggplot(data_res) +
geom_point(aes(x = log(Population),
y = Month,
color = .pred_class))
ggplot(data_res) +
geom_point(aes(x = (Population),
y = Month,
color = .pred_class))
ggplot(data_res) +
geom_point(aes(x = log(Population),
y = Month,
color = .pred_class))
cormat <- round(cor(data_res), 2)
data_res %>% names
lapply(data_res, as.numeric)
data_res <- lapply(data_res, as.numeric)
cormat <- round(cor(data_res), 2)
data_res
data_res <- lapply(data_res, as.numeric) %>% as.matrix()
cormat <- round(cor(data_res), 2)
data_res
data_res <- sapply(data_res, as.numeric)
cormat <- round(cor(data_res), 2)
data_res
cormat <- round(cor(data_res), 2)
cormat <- round(cor(data_res), 2)
cormat
data_res <- sapply(data_res, as.numeric)
cormat <- round(cor(data_res), 2)
data_res
data_res %>% as.numeric()
data_res %>% as.matrix()
sapply(data_res,typeof)
data_res
data_res <- data %>%
bind_cols(predict(model_st_40,.)) %>%
bind_cols(Month = test_rwf_df_deploy$Month)
data_res
cormat <- round(cor(data_res), 2)
sapply(data_res,typeof)
data_res <- data_res %>%
mutate(.pred_class = .pred_class %>% as.numeric()) %>%
mutate(Population = Population %>% as.numeric())
cormat <- round(cor(data_res), 2)
library(reshape2)
melted_cormat <- melt(cormat)
ggplot(data = melted_cormat, aes(x=Var1, y=var2, fill=value)) +
geom_tile
ggplot(data = melted_cormat, aes(x=Var1, y=var2, fill=value)) +
geom_tile()
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) +
geom_tile()
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) +
geom_tile() +
theme(axis.text.x = element_text(angle = 45))
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) +
geom_tile() +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) +
geom_tile() +
scale_fill_gradient2(low = 'blue',
high = 'red',
mid = 'white')
ggplot(data = melted_cormat, aes(x=Var1, y=Var2, fill=value)) +
geom_tile() +
scale_fill_gradient2(low = 'blue',
high = 'red',
mid = 'white') +
theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
